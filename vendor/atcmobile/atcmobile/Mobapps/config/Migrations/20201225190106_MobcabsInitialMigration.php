<?php

use Migrations\AbstractMigration;
use Phinx\Db\Adapter\MysqlAdapter;

class MobcabsInitialMigration extends AbstractMigration
{
    public function up()
    {

    $this->table('mobcabs',['id' => false, 'primary_key' => ['id']])
        ->addColumn('id', 'biginteger', [ 'default' => null, 'limit' => 20, 'null' => false, 'identity' => true ])
        ->addColumn('drv_id', 'biginteger', [ 'default' => 0, 'limit' => 20, 'null' => true ])
        ->addColumn('drv_name', 'string', [ 'default' => '', 'limit' => 100, 'null' => true, ])
        ->addColumn('drv_phone', 'string', [ 'default' => '', 'limit' => 50, 'null' => true, ])
        ->addColumn('drv_email', 'string', [ 'default' => '', 'limit' => 100, 'null' => true, ])
        ->addColumn('drv_img', 'string', [ 'default' => '', 'limit' => 255, 'null' => true, ])
        ->addColumn('drv_img_w', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('drv_img_h', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('drv_lat', 'double', [ 'null' => 0, 'default' => 0])
        ->addColumn('drv_lng', 'double', [ 'null' => 0, 'default' => 0])
        ->addColumn('vmodel', 'string', [ 'default' => '', 'limit' => 255, 'null' => true, ])
        ->addColumn('vmanyr', 'string', [ 'default' => '', 'limit' => 10, 'null' => true, ])
        ->addColumn('vseats', 'integer', [ 'default' => 1, 'null' => true, ])
        ->addColumn('vlicplat', 'string', [ 'default' => '', 'limit' => 50, 'null' => true, ])
        ->addColumn('cli_id', 'biginteger', [ 'default' => 0, 'limit' => 20, 'null' => true ])
        ->addColumn('cli_name', 'string', [ 'default' => '', 'limit' => 100, 'null' => true, ])
        ->addColumn('cli_phone', 'string', [ 'default' => '', 'limit' => 50, 'null' => true, ])
        ->addColumn('cli_email', 'string', [ 'default' => '', 'limit' => 100, 'null' => true, ])
        ->addColumn('cli_img', 'string', [ 'default' => '', 'limit' => 255, 'null' => true, ])
        ->addColumn('cli_img_w', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('cli_img_h', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('cli_lat', 'double', [ 'null' => 0, 'default' => 0])
        ->addColumn('cli_lng', 'double', [ 'null' => 0, 'default' => 0])
        ->addColumn('start_addr', 'string', [ 'default' => '', 'limit' => 512, 'null' => true, ])
        ->addColumn('start_addr2', 'string', [ 'default' => '', 'limit' => 512, 'null' => true, ])
        ->addColumn('start_place', 'string', [ 'default' => '', 'limit' => 512, 'null' => true, ])
        ->addColumn('start_lat', 'double', [ 'null' => true, 'default' => 0])
        ->addColumn('start_lng', 'double', [ 'null' => true, 'default' => 0])
        ->addColumn('dest_addr', 'string', [ 'default' => '', 'limit' => 512, 'null' => true, ])
        ->addColumn('dest_addr2', 'string', [ 'default' => '', 'limit' => 512, 'null' => true, ])
        ->addColumn('dest_place', 'string', [ 'default' => '', 'limit' => 512, 'null' => true, ])
        ->addColumn('dest_lat', 'double', [ 'null' => true, 'default' => 0])
        ->addColumn('dest_lng', 'double', [ 'null' => true, 'default' => 0])
        ->addColumn('cabpickedup', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('cabfinish', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('pcabfr', 'text', [ 'limit' => MysqlAdapter::TEXT_MEDIUM, 'default' => '', 'null' => true, ])
        ->addColumn('pcabto', 'text', [ 'limit' => MysqlAdapter::TEXT_MEDIUM,  'default' => '', 'null' => true, ])
        ->addColumn('distance', 'double', [ 'null' => true, 'default' => 0])
        ->addColumn('units', 'string', [ 'default' => 'km', 'limit' => 20, 'null' => true, ])
        ->addColumn('is_taxi', 'integer', [ 'default' => 1, 'null' => true, ])
        ->addColumn('is_bike', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('is_car', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('car_seats', 'integer', [ 'default' => 5, 'null' => true, ])
        ->addColumn('taxi_status', 'string', [ 'default' => 'PlacePicking', 'limit' => 255, 'null' => true, ]) // PlacePicking, Calling, Shifting, Client Paided, Cancelled
        ->addColumn('is_deli', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('order_id', 'biginteger', [ 'default' => 0, 'limit' => 20, 'null' => true ])
        ->addColumn('ord_subtotal', 'float', [ 'null' => true, 'default' => 0])
        ->addColumn('ord_ship', 'float', [ 'null' => true, 'default' => 0])
        ->addColumn('ord_total', 'float', [ 'null' => true, 'default' => 0])
        ->addColumn('deli_status', 'string', [ 'default' => 'PlacePicking', 'limit' => 255, 'null' => true, ]) // PlacePicking, Calling, Shifting, Client Paided, Store Paided, Cancelled
        ->addColumn('keep_hot', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('keep_cool', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('cabprice', 'float', [ 'null' => true, 'default' => 0]) // if deli, price = ord_ship - tax
        ->addColumn('cabtax', 'float', [ 'null' => true, 'default' => 0])
        ->addColumn('cabtotal', 'float', [ 'null' => true, 'default' => 0])
        ->addColumn('currency', 'string', [ 'default' => 'VND', 'limit' => 30, 'null' => true, ])
        ->addColumn('by_cash', 'integer', [ 'default' => 1, 'null' => true, ])
        ->addColumn('payment_method', 'string', [ 'default' => '', 'limit' => 255, 'null' => true, ])
        ->addColumn('card_owner', 'string', [ 'default' => '', 'limit' => 255, 'null' => true, ])
        ->addColumn('card_number', 'string', [ 'default' => '', 'limit' => 50, 'null' => true, ])
        ->addColumn('card_code', 'string', [ 'default' => '', 'limit' => 50, 'null' => true, ])
        ->addColumn('card_year', 'string', [ 'default' => '', 'limit' => 10, 'null' => true, ])
        ->addColumn('card_month', 'string', [ 'default' => '', 'limit' => 10, 'null' => true, ])
        ->addColumn('authorization', 'string', [ 'default' => '', 'limit' => 255, 'null' => true, ])
        ->addColumn('transaction', 'string', [ 'default' => '', 'limit' => 255, 'null' => true, ])
        ->addColumn('clidevinfo', 'text', [ 'limit' => MysqlAdapter::TEXT_MEDIUM, 'default' => '', 'null' => true, ])
        ->addColumn('drvdevinfo', 'text', [ 'limit' => MysqlAdapter::TEXT_MEDIUM,  'default' => '', 'null' => true, ])
        ->addColumn('status', 'string', [ 'default' => 'PlacePicking', 'limit' => 255, 'null' => true, ])  // PlacePicking, Calling, Shifting, Finished, Paided, Cancelled
        ->addColumn('cancelled', 'integer', [ 'default' => 0, 'null' => true, ])
        ->addColumn('lft', 'integer', [ 'default' => null, 'null' => true, ])
        ->addColumn('rght', 'integer', [ 'default' => null, 'null' => true, ])
        ->addColumn('created_by', 'integer', [ 'default' => 1, 'limit' => 11, 'null' => true, ])
        ->addColumn('modified_by', 'integer', [ 'default' => 1, 'limit' => 11, 'null' => true, ])
        ->addTimestamps('created', 'modified')
        ->addIndex( [ 'drv_id', ] )
        ->addIndex( [ 'drv_lat', ] )
        ->addIndex( [ 'drv_lng', ] )
        ->addIndex( [ 'cli_id', ] )
        ->addIndex( [ 'cli_lat', ] )
        ->addIndex( [ 'cli_lng', ] )
        ->addIndex( [ 'is_deli', ] )
        ->addIndex( [ 'is_taxi', ] )
        ->addIndex( [ 'is_bike', ] )
        ->addIndex( [ 'is_car', ] )
        ->addIndex( [ 'keep_hot', ] )
        ->addIndex( [ 'keep_cool', ] )
        ->addIndex( [ 'drv_phone', ] )
        ->addIndex( [ 'drv_email', ] )
        ->addIndex( [ 'vlicplat', ] )
        ->addIndex( [ 'cli_phone', ] )
        ->addIndex( [ 'cli_email', ] )
        ->addIndex( [ 'start_lat', ] )
        ->addIndex( [ 'start_lng', ] )
        ->addIndex( [ 'start_place', ] )
        ->addIndex( [ 'dest_lat', ] )
        ->addIndex( [ 'dest_lng', ] )
        ->addIndex( [ 'dest_place', ] )
        ->addIndex( [ 'status', ] )
        ->addIndex( [ 'taxi_status', ] )
        ->addIndex( [ 'deli_status', ] )
        ->create();
    }

    public function down()
    {
        $this->table('mobcabs')->drop()->save();
    }
}
